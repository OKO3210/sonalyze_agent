# ğŸ”„ Workflow Sonalyze - Du Capteur au Rapport

## Diagramme Global

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           WORKFLOW SONALYZE                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  CLIENT     â”‚
    â”‚  installe   â”‚
    â”‚  boÃ®tier    â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          1ï¸âƒ£ CAPTEUR IoT (24h)                â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
    â”‚  â”‚  Microphone â†’ ModÃ¨le AST embarquÃ©   â”‚    â”‚
    â”‚  â”‚  - Mesure dB en continu             â”‚    â”‚
    â”‚  â”‚  - Classification sons (527 classes) â”‚    â”‚
    â”‚  â”‚  - Export JSON (~8000 segments)     â”‚    â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼ JSON brut
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          2ï¸âƒ£ DATA LOADER                      â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
    â”‚  â”‚  Validation structure               â”‚    â”‚
    â”‚  â”‚  Nettoyage donnÃ©es aberrantes       â”‚    â”‚
    â”‚  â”‚  Enrichissement (heure, jour/nuit)  â”‚    â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼ DataFrame Pandas
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          3ï¸âƒ£ AGGREGATOR                       â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
    â”‚  â”‚  Stats globales (moyenne, min, max) â”‚    â”‚
    â”‚  â”‚  SÃ©paration JOUR / NUIT             â”‚    â”‚
    â”‚  â”‚  Top 5 sons + familles              â”‚    â”‚
    â”‚  â”‚  Calcul note DPS (A-G)              â”‚    â”‚
    â”‚  â”‚  Distribution par note              â”‚    â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼ Dict analysis
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                       â”‚
           â–¼                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 4ï¸âƒ£ CHARTS   â”‚         â”‚ 5ï¸âƒ£ LLM      â”‚
    â”‚             â”‚         â”‚   (Groq)    â”‚
    â”‚ - Jauge DPS â”‚         â”‚             â”‚
    â”‚ - Camembertsâ”‚         â”‚ - InterprÃ©- â”‚
    â”‚ - Heatmap   â”‚         â”‚   tation    â”‚
    â”‚ - Barres    â”‚         â”‚ - Analyse   â”‚
    â”‚ - Jour/Nuit â”‚         â”‚ - Recos     â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚                       â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          6ï¸âƒ£ APP STREAMLIT                    â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
    â”‚  â”‚  Upload JSON                        â”‚    â”‚
    â”‚  â”‚  Formulaire infos logement          â”‚    â”‚
    â”‚  â”‚  Affichage graphiques interactifs   â”‚    â”‚
    â”‚  â”‚  Toggle JOUR / NUIT                 â”‚    â”‚
    â”‚  â”‚  TÃ©lÃ©chargement PDF                 â”‚    â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          7ï¸âƒ£ RAPPORT PDF                      â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
    â”‚  â”‚  Page 1: SynthÃ¨se (note A-G)        â”‚    â”‚
    â”‚  â”‚  Page 2: Analyse dÃ©taillÃ©e          â”‚    â”‚
    â”‚  â”‚  Page 3: Sources de bruit           â”‚    â”‚
    â”‚  â”‚  Page 4: Recommandations            â”‚    â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## DÃ©tail par Module

### 1ï¸âƒ£ Capteur IoT (BoÃ®tier Sonalyze)

**EntrÃ©e :** Environnement sonore rÃ©el (24h)

**Traitement embarquÃ© :**
- Enregistrement audio continu
- DÃ©coupage en segments de ~9 secondes
- ModÃ¨le AST (Audio Spectrogram Transformer)
- Classification parmi 527 classes AudioSet
- Mesure dÃ©cibels (LAeq, Lmin, Lmax, L10, L50, L90)

**Sortie :** Fichier JSON (~8000 segments)

---

### 2ï¸âƒ£ Data Loader (`data_loader.py`)

**EntrÃ©e :** JSON brut

**Traitement :**
```
JSON â†’ Validation â†’ Nettoyage â†’ Enrichissement â†’ DataFrame
```

**Validations :**
- âœ… Champs obligatoires prÃ©sents
- âœ… Format timestamp correct
- âœ… dB dans [0-130]
- âœ… ProbabilitÃ©s dans [0-1]

**Enrichissement :**
- `hour` : Heure extraite du timestamp
- `is_night` : True si 22h â‰¤ heure < 7h
- `top_label` : Son principal (top_5_labels[0])

**Sortie :** DataFrame Pandas

---

### 3ï¸âƒ£ Aggregator (`aggregator.py`)

**EntrÃ©e :** DataFrame

**Calculs :**

| Fonction | Output |
|----------|--------|
| `calculate_global_stats()` | Moyenne, min, max, note globale |
| `calculate_day_night_stats()` | Stats sÃ©parÃ©es jour/nuit |
| `calculate_top_sounds()` | Top 5 sons avec % et note |
| `calculate_top_sounds_by_period()` | Top 5 JOUR et Top 5 NUIT |
| `calculate_family_by_period()` | Familles avec notes par pÃ©riode |
| `calculate_rating_distribution()` | Distribution A-G |

**Sortie :** Dictionnaire `analysis`

---

### 4ï¸âƒ£ Charts (`charts.py`)

**EntrÃ©e :** `analysis` + DataFrame

**Graphiques gÃ©nÃ©rÃ©s :**

| Graphique | Description | DonnÃ©es |
|-----------|-------------|---------|
| `gauge` | Jauge de performance | Note + dB moyen |
| `rating_bars` | Distribution A-G | Pourcentages |
| `day_night` | Comparaison | Moyennes jour/nuit |
| `top_sounds_jour` | Top 5 sons jour | Avec notes DPS |
| `top_sounds_nuit` | Top 5 sons nuit | Avec notes DPS |
| `family_pie_jour` | Familles jour | Avec dB moyens |
| `family_pie_nuit` | Familles nuit | Avec dB moyens |
| `sounds_heatmap` | 24h Ã— Sons | Occurrences + notes |

**Sortie :** Figures Plotly

---

### 5ï¸âƒ£ LLM Client (`llm_client.py`)

**EntrÃ©e :** `analysis` + `logement_info`

**Appels API Groq :**

| Fonction | Prompt | Output |
|----------|--------|--------|
| `generate_grade_interpretation()` | Expliquer la note | 2-3 paragraphes |
| `generate_sounds_analysis()` | Analyser les sources | 2-3 paragraphes |
| `generate_recommendations()` | Solutions par Ã©lÃ©ment | JSON structurÃ© |
| `generate_summary_email()` | Email client | Texte formatÃ© |

**Configuration :**
- ModÃ¨le : `llama-3.3-70b-versatile`
- Temperature : `0.3` (cohÃ©rent)
- Max tokens : `2000`

**Sortie :** Textes d'interprÃ©tation

---

### 6ï¸âƒ£ App Streamlit (`app.py`)

**Interface utilisateur :**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”Š SONALYZE - Diagnostic Performance Sonore       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  ğŸ“ Upload fichier JSON    [Parcourir...]         â”‚
â”‚                                                    â”‚
â”‚  ğŸ  Informations logement                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Type: [Appartement â–¼]  Ã‰tage: [3 â–¼]         â”‚ â”‚
â”‚  â”‚ PiÃ¨ce: [Salon â–¼]       Ville: [______]      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                    â”‚
â”‚  [  ğŸ” Analyser  ]                                â”‚
â”‚                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  ğŸ“Š RÃ‰SULTATS              [â˜€ï¸ Jour] [ğŸŒ™ Nuit]   â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  NOTE    â”‚  â”‚                               â”‚ â”‚
â”‚  â”‚    D     â”‚  â”‚    [Graphiques Plotly]        â”‚ â”‚
â”‚  â”‚  46 dB   â”‚  â”‚                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                    â”‚
â”‚  ğŸ’¬ INTERPRÃ‰TATION IA                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Votre logement obtient la note D...         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                    â”‚
â”‚  [  ğŸ“¥ TÃ©lÃ©charger PDF  ]                        â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 7ï¸âƒ£ Rapport PDF

**Structure du rapport :**

| Page | Contenu |
|------|---------|
| **1** | SynthÃ¨se : Note A-G, adresse, date, jauge |
| **2** | Analyse : Graphiques jour/nuit, distribution |
| **3** | Sources : Top sons, familles, heatmap |
| **4** | Recommandations : Solutions par Ã©lÃ©ment |

---

## Temps d'exÃ©cution

| Ã‰tape | DurÃ©e |
|-------|-------|
| Chargement JSON | ~0.5s |
| Validation | ~0.2s |
| AgrÃ©gation | ~1s |
| Graphiques | ~2s |
| LLM (4 appels) | ~4s |
| **TOTAL** | **~8s** |

---

## Flux de donnÃ©es simplifiÃ©

```
JSON (24h de mesures)
         â”‚
         â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ DataLoader â”‚â”€â”€â–¶ Validation + Enrichissement
   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ DataFrame
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Aggregator â”‚â”€â”€â–¶ Stats + Notes + Classifications
   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚         â”‚
    â–¼         â–¼
 Charts    LLM Client
    â”‚         â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
         â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Streamlit  â”‚â”€â”€â–¶ Interface interactive
   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚    PDF    â”‚â”€â”€â–¶ Rapport tÃ©lÃ©chargeable
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

*Workflow crÃ©Ã© pour le hackathon La Forge 2025 - Ã‰quipe Patria*
