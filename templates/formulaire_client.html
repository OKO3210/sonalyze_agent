<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulaire Diagnostic Sonalyze</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .form-content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
        }

        .section-header {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e0e0e0;
            font-weight: 600;
            color: #2c3e50;
            font-size: 16px;
        }

        .section-content {
            padding: 20px;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }

        .form-group {
            flex: 1;
        }

        .form-group.full {
            flex: 100%;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #444;
            font-size: 14px;
        }

        label .required {
            color: #e74c3c;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 14px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        input::placeholder {
            color: #aaa;
        }

        .slider-group {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .slider-group input[type="range"] {
            flex: 1;
            padding: 0;
            height: 8px;
            -webkit-appearance: none;
            background: #e0e0e0;
            border-radius: 4px;
            border: none;
        }

        .slider-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #667eea;
            border-radius: 50%;
            cursor: pointer;
        }

        .slider-value {
            min-width: 40px;
            text-align: center;
            font-weight: 600;
            color: #667eea;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .pieces-container {
            border: 2px dashed #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-top: 10px;
        }

        .piece-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .piece-item input, .piece-item select {
            flex: 1;
        }

        .btn-remove {
            background: #e74c3c;
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-add {
            background: #27ae60;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            margin-top: 10px;
        }

        .btn-add:hover {
            background: #219a52;
        }

        .actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }

        .btn-primary {
            flex: 1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            flex: 1;
            background: #95a5a6;
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            color: #666;
            font-size: 13px;
        }

        .success-message {
            display: none;
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
        }

        .info-box {
            background: #e8f4fd;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 0 8px 8px 0;
            font-size: 14px;
            color: #2c3e50;
        }

        @media (max-width: 600px) {
            .form-row {
                flex-direction: column;
                gap: 15px;
            }
            
            .piece-item {
                flex-direction: column;
            }
            
            .actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Diagnostic de Performance Sonore</h1>
            <p>Formulaire d'information - Merci de remplir tous les champs</p>
        </div>

        <form id="sonalyzeForm" class="form-content">
            
            <div class="info-box">
                Ce formulaire nous permet de préparer votre diagnostic sonore. 
                Une fois complété, cliquez sur "Télécharger mes réponses" et renvoyez le fichier à votre diagnostiqueur.
            </div>

            <!-- SECTION 1: Informations client -->
            <div class="section">
                <div class="section-header">1. Vos coordonnées</div>
                <div class="section-content">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nom <span class="required">*</span></label>
                            <input type="text" id="nom" required placeholder="Votre nom">
                        </div>
                        <div class="form-group">
                            <label>Prénom <span class="required">*</span></label>
                            <input type="text" id="prenom" required placeholder="Votre prénom">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Email <span class="required">*</span></label>
                            <input type="email" id="email" required placeholder="votre@email.com">
                        </div>
                        <div class="form-group">
                            <label>Téléphone</label>
                            <input type="tel" id="telephone" placeholder="06 XX XX XX XX">
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECTION 2: Informations logement -->
            <div class="section">
                <div class="section-header">2. Votre logement</div>
                <div class="section-content">
                    <div class="form-row">
                        <div class="form-group full">
                            <label>Nom du logement (optionnel)</label>
                            <input type="text" id="nom_logement" placeholder="Ex: Appartement principal, Maison de campagne...">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group full">
                            <label>Adresse <span class="required">*</span></label>
                            <input type="text" id="adresse" required placeholder="Numéro et nom de rue">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Code postal <span class="required">*</span></label>
                            <input type="text" id="code_postal" required placeholder="75001" maxlength="5">
                        </div>
                        <div class="form-group">
                            <label>Ville <span class="required">*</span></label>
                            <input type="text" id="ville" required placeholder="Paris">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Type de logement <span class="required">*</span></label>
                            <select id="type_logement" required>
                                <option value="">-- Sélectionner --</option>
                                <option value="Appartement">Appartement</option>
                                <option value="Maison">Maison</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Étage (si appartement)</label>
                            <select id="etage">
                                <option value="">-- Sélectionner --</option>
                                <option value="RDC">Rez-de-chaussée</option>
                                <option value="1">1er étage</option>
                                <option value="2">2ème étage</option>
                                <option value="3">3ème étage</option>
                                <option value="4">4ème étage</option>
                                <option value="5">5ème étage</option>
                                <option value="6+">6ème étage ou plus</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Typologie <span class="required">*</span></label>
                            <select id="typologie" required>
                                <option value="">-- Sélectionner --</option>
                                <option value="Studio">Studio</option>
                                <option value="T1">T1</option>
                                <option value="T2">T2</option>
                                <option value="T3">T3</option>
                                <option value="T4">T4</option>
                                <option value="T5">T5</option>
                                <option value="T6+">T6 ou plus</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Surface totale (m²)</label>
                            <input type="number" id="surface_totale" placeholder="Ex: 65" min="1" max="1000">
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECTION 3: Pièces -->
            <div class="section">
                <div class="section-header">3. Les pièces de votre logement</div>
                <div class="section-content">
                    <p style="margin-bottom: 15px; color: #666; font-size: 14px;">
                        Ajoutez chaque pièce où vous souhaitez un diagnostic. Le boîtier sera placé dans la pièce principale.
                    </p>
                    <div id="pieces-container" class="pieces-container">
                        <!-- Les pièces seront ajoutées ici dynamiquement -->
                    </div>
                    <button type="button" class="btn-add" onclick="addPiece()">+ Ajouter une pièce</button>
                </div>
            </div>

            <!-- SECTION 4: Environnement extérieur -->
            <div class="section">
                <div class="section-header">4. Environnement sonore extérieur</div>
                <div class="section-content">
                    <p style="margin-bottom: 20px; color: #666; font-size: 14px;">
                        Évaluez le niveau de bruit de votre environnement (0 = aucun, 5 = très fort)
                    </p>
                    
                    <div class="form-group" style="margin-bottom: 20px;">
                        <label>Bruit de circulation routière</label>
                        <div class="slider-group">
                            <span>0</span>
                            <input type="range" id="bruit_circulation" min="0" max="5" value="0" 
                                   oninput="document.getElementById('val_circulation').textContent = this.value">
                            <span>5</span>
                            <span class="slider-value" id="val_circulation">0</span>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 20px;">
                        <label>Bruit ferroviaire (train, métro, tramway)</label>
                        <div class="slider-group">
                            <span>0</span>
                            <input type="range" id="bruit_ferroviaire" min="0" max="5" value="0"
                                   oninput="document.getElementById('val_ferroviaire').textContent = this.value">
                            <span>5</span>
                            <span class="slider-value" id="val_ferroviaire">0</span>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 20px;">
                        <label>Bruit aérien (avions, hélicoptères)</label>
                        <div class="slider-group">
                            <span>0</span>
                            <input type="range" id="bruit_aerien" min="0" max="5" value="0"
                                   oninput="document.getElementById('val_aerien').textContent = this.value">
                            <span>5</span>
                            <span class="slider-value" id="val_aerien">0</span>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" id="zones_festives">
                                <label for="zones_festives" style="margin: 0;">Zones festives à proximité (bars, boîtes de nuit)</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group" id="distance_boites_group" style="display: none; margin-top: 15px;">
                        <label>Distance approximative (en mètres)</label>
                        <input type="number" id="distance_boites" placeholder="Ex: 200" min="0" max="5000">
                    </div>
                </div>
            </div>

            <!-- SECTION 5: Commentaires -->
            <div class="section">
                <div class="section-header">5. Informations complémentaires (optionnel)</div>
                <div class="section-content">
                    <div class="form-group">
                        <label>Décrivez vos nuisances sonores principales</label>
                        <textarea id="commentaires" rows="4" 
                                  placeholder="Ex: Bruit de circulation la nuit, voisins bruyants le week-end, travaux fréquents dans l'immeuble..."></textarea>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="actions">
                <button type="button" class="btn-secondary" onclick="resetForm()">Effacer tout</button>
                <button type="button" class="btn-primary" onclick="downloadJSON()">Télécharger mes réponses</button>
            </div>

            <div id="success-message" class="success-message">
                Fichier téléchargé avec succès ! Envoyez-le à votre diagnostiqueur.
            </div>
        </form>

        <div class="footer">
            Sonalyze - Diagnostic de Performance Sonore<br>
            Le calme à portée de diagnostic
        </div>
    </div>

    <script>
        let pieceCount = 0;

        // Types de pièces disponibles
        const typesPieces = [
            "Chambre", "Salon", "Cuisine", "Salle de bain", "Toilettes",
            "Couloir", "Bureau", "Salle à manger", "Cave", "Garage", "Autre"
        ];

        // Ajouter une pièce par défaut au chargement
        window.onload = function() {
            addPiece();
        };

        // Afficher/masquer le champ distance boîtes de nuit
        document.getElementById('zones_festives').addEventListener('change', function() {
            document.getElementById('distance_boites_group').style.display = 
                this.checked ? 'block' : 'none';
        });

        function addPiece() {
            pieceCount++;
            const container = document.getElementById('pieces-container');
            
            const pieceDiv = document.createElement('div');
            pieceDiv.className = 'piece-item';
            pieceDiv.id = `piece-${pieceCount}`;
            
            // Créer les options du select
            let optionsHTML = '<option value="">-- Type --</option>';
            typesPieces.forEach(type => {
                optionsHTML += `<option value="${type}">${type}</option>`;
            });
            
            pieceDiv.innerHTML = `
                <input type="text" placeholder="Nom de la pièce (ex: Chambre parentale)" 
                       id="piece_nom_${pieceCount}">
                <select id="piece_type_${pieceCount}">${optionsHTML}</select>
                <input type="number" placeholder="Surface m²" min="1" max="500" 
                       id="piece_surface_${pieceCount}" style="max-width: 100px;">
                <button type="button" class="btn-remove" onclick="removePiece(${pieceCount})">×</button>
            `;
            
            container.appendChild(pieceDiv);
        }

        function removePiece(id) {
            const piece = document.getElementById(`piece-${id}`);
            if (piece) {
                piece.remove();
            }
        }

        function collectPieces() {
            const pieces = [];
            const container = document.getElementById('pieces-container');
            const pieceItems = container.querySelectorAll('.piece-item');
            
            pieceItems.forEach(item => {
                const id = item.id.split('-')[1];
                const nom = document.getElementById(`piece_nom_${id}`)?.value || '';
                const type = document.getElementById(`piece_type_${id}`)?.value || '';
                const surface = document.getElementById(`piece_surface_${id}`)?.value || '';
                
                if (nom || type) {
                    pieces.push({
                        nom: nom || type,
                        type: type,
                        surface_m2: surface ? parseFloat(surface) : null
                    });
                }
            });
            
            return pieces;
        }

        function collectFormData() {
            const now = new Date().toISOString();
            
            return {
                informations_client: {
                    nom: document.getElementById('nom').value,
                    prenom: document.getElementById('prenom').value,
                    email: document.getElementById('email').value,
                    telephone: document.getElementById('telephone').value
                },
                informations_logement: {
                    nom_logement: document.getElementById('nom_logement').value,
                    adresse: document.getElementById('adresse').value,
                    code_postal: document.getElementById('code_postal').value,
                    ville: document.getElementById('ville').value,
                    type_logement: document.getElementById('type_logement').value,
                    etage: document.getElementById('etage').value,
                    typologie: document.getElementById('typologie').value,
                    surface_totale_m2: document.getElementById('surface_totale').value 
                        ? parseFloat(document.getElementById('surface_totale').value) : null
                },
                pieces: collectPieces(),
                environnement_exterieur: {
                    bruit_circulation_routiere: parseInt(document.getElementById('bruit_circulation').value),
                    bruit_ferroviaire: parseInt(document.getElementById('bruit_ferroviaire').value),
                    bruit_aerien: parseInt(document.getElementById('bruit_aerien').value),
                    zones_festives_proximite: document.getElementById('zones_festives').checked,
                    distance_boites_nuit_m: document.getElementById('distance_boites').value 
                        ? parseInt(document.getElementById('distance_boites').value) : null
                },
                commentaires: document.getElementById('commentaires').value,
                metadata: {
                    date_creation: now,
                    date_modification: now,
                    statut: "en_attente",
                    fichier_json_boitier: "",
                    source: "formulaire_html"
                }
            };
        }

        function validateForm() {
            const required = ['nom', 'prenom', 'email', 'adresse', 'code_postal', 'ville', 'type_logement', 'typologie'];
            let valid = true;
            
            required.forEach(id => {
                const el = document.getElementById(id);
                if (!el.value) {
                    el.style.borderColor = '#e74c3c';
                    valid = false;
                } else {
                    el.style.borderColor = '#e0e0e0';
                }
            });
            
            if (!valid) {
                alert('Veuillez remplir tous les champs obligatoires (marqués d\'un *)');
            }
            
            return valid;
        }

        function downloadJSON() {
            if (!validateForm()) return;
            
            const data = collectFormData();
            const json = JSON.stringify(data, null, 2);
            
            // Créer le nom du fichier
            const nom = data.informations_client.nom || 'client';
            const prenom = data.informations_client.prenom || '';
            const date = new Date().toISOString().slice(0,10);
            const filename = `formulaire_${nom}_${prenom}_${date}.json`
                .toLowerCase()
                .replace(/\s+/g, '_');
            
            // Télécharger
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // Afficher le message de succès
            document.getElementById('success-message').style.display = 'block';
            setTimeout(() => {
                document.getElementById('success-message').style.display = 'none';
            }, 5000);
        }

        function resetForm() {
            if (confirm('Êtes-vous sûr de vouloir effacer toutes vos réponses ?')) {
                document.getElementById('sonalyzeForm').reset();
                document.getElementById('pieces-container').innerHTML = '';
                document.getElementById('distance_boites_group').style.display = 'none';
                document.getElementById('val_circulation').textContent = '0';
                document.getElementById('val_ferroviaire').textContent = '0';
                document.getElementById('val_aerien').textContent = '0';
                pieceCount = 0;
                addPiece();
            }
        }
    </script>
</body>
</html>
